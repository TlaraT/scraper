import pandas as pd
import re
from unidecode import unidecode

# --- CONFIGURACIÓN ---
NOMBRE_ARCHIVO_SALIDA = "catalogo_final_unido.xlsx"
# ---------------------

def super_normalizar(texto):
    """
    Función de normalización definitiva.
    Convierte a minúsculas, quita acentos y ELIMINA todos los caracteres
    que no sean letras o números para crear una 'huella digital'.
    """
    # 1. Convertir a string, minúsculas y quitar acentos
    texto_limpio = unidecode(str(texto).lower())
    # 2. Eliminar TODO lo que no sea letra o número
    texto_limpio = re.sub(r'[^a-z0-9]', '', texto_limpio)
    return texto_limpio

# --- DATOS DE ENTRADA (Transcritos de tus imágenes) ---

# Lista de descripciones originales
LISTA_DESCRIPCIONES = [
    "CAPACITOR 4.5 MFD 450V", "CAPACITOR 40MF 450V 4 TERMINALES BLANCO", "CAPACITOR 250MFD 250V",
    "CAPACITOR 30+10UF 110 125 VAC", "CAPACITOR 10MFD 440V CABLE NEGRO ELEVADOR", "CAPACITOR 12 MFD 250VCA P/VENTILADOR",
    "CAPACITOR 12.5 + 5 MFD 370 VCA PARA VENTY CON CABLE", "CAPACITOR 12.5 + 6 MFD 370V", "CAPACITOR 14 MDF 250V",
    "CAPACITOR 15 + 2.5 MFD 370 VCA", "CAPACITOR 15 MFD 250VAC P/CLIMA", "CAPACITOR 15 MDF 250V",
    "CAPACITOR 2.5 UF 450V VENTILADOR", "CAPACITOR 20 MFD 370-440VCA GRIS", "CAPACITOR 25 MFD 370-440 VCA BLANCO",
    "CAPACITOR 25MFD+5MFD 250V 4 TERMINALES BLANCO", "CAPACITOR 3.5MF 450V NEGRO", "CAPACITOR 3UF 250 VAC DE VENTILADOR",
    "CAPACITOR 3UF 450V P/VENTILADOR", "CAPACITOR 30+10-5 MF 440 VCA BOMBA", "CAPACITOR 35 + 1.5 MF 440 VCA",
    "CAPACITOR 35 + 2.5 MF 440 VCA", "CAPACITOR 35 + 5 MFD 370/440VCA", "CAPACITOR 35+6 370VCA",
    "CAPACITOR 350MFD 250V A 440VOLT", "CAPACITOR 378-440 110/125", "CAPACITOR 4+2.5 MF 370 VCA",
    "CAPACITOR 4.5 MFD 450VCA", "CAPACITOR 40 MDF 250VAC", "CAPACITOR 40+5 440 VCA",
    "CAPACITOR 40+5=2.5 440 VCA", "CAPACITOR 41UF 15MF", "CAPACITOR 4.5 UF 250 VCA",
    "CAPACITOR 45 MF 250VAC PLASTICO BLANCO", "CAPACITOR 45 MFD + 5 370 A 440", "CAPACITOR 45 MF A 250 VCA PARA LAVADORA CON BASE",
    "CAPACITOR 5.5 UF 250 VCA", "CAPACITOR 50 MF 250 VCA", "CAPACITOR 50 MF 370 VCA/440V",
    "CAPACITOR 50 MFD 250VAC", "CAPACITOR 50MFD/250-450VAC", "CAPACITOR 50UF 370VCA",
    "CAPACITOR 55 MFD 370 VCA/440", "CAPACITOR 60 UF 250 VAC MABE ORIG", "CAPACITOR 70 UF 250 VCA",
    "CAPACITOR 72-88 220VAC 50-60HZ", "CAPACITOR 8 MF 370 VCA", "CAPACITOR 8 MFD 440 VCA",
    "CAPACITOR CON CABLE DE 5+5 250 VCA", "CAPACITOR DE 1.5 MF 450V", "CAPACITOR DE 1.8 MF 450V",
    "CAPACITOR DE 10 MF 250 VCA", "CAPACITOR DE 10 MFD 370 VCA", "CAPACITOR DE 15 A 250VAC",
    "CAPACITOR DE 15 MF RECTANGULAR", "CAPACITOR DE 150MF 250VAC", "CAPACITOR DE 16MFD 250V 4 TERMINALES BLANCO",
    "CAPACITOR DE 2 + 1 440 VCA", "CAPACITOR DE 25 MFD A 440VOLT", "CAPACITOR DE 2+2 UF P/4 V 440 VAC",
    "CAPACITOR DE 30+5 440V", "CAPACITOR DE 35 MF 250V", "CAPACITOR DE 350-400 125 VAC",
    "CAPACITOR DE 35+5 MF A 440 VAC", "CAPACITOR DE 4 MF 450V PARA VENTILADOR", "CAPACITOR DE 4.5 MF 450V",
    "CAPACITOR DE 45-6 MF A 250 VAC", "CAPACITOR DE 4MFD 250V", "CAPACITOR DE 4MFD 440 50/60",
    "CAPACITOR DE 5+5 UF 370 VCA", "CAPACITOR DE 50+5UF 370/440 VAC CLIMA", "CAPACITOR DE 50+5UF A 440VAC",
    "CAPACITOR DE 5MF 440V 50/60", "CAPACITOR DE 6.5 MFD 450V", "CAPACITOR DE 60 UF A 440VAC",
    "CAPACITOR DE 60+5 MF 370 VCA", "CAPACITOR DE 6MFD 440-50/60 TERMINAL", "CAPACITOR DE 7.5UF 370V",
    "CAPACITOR DE 70+5 440V", "CAPACITOR DE 7MFD 370-50-60", "CAPACITOR DE 8 MF 450V",
    "CAPACITOR DE BOMBA 40-48", "CAPACITOR DE DOBLE 15 UF A 250VAC", "CAPACITOR DE LAVADORA 35+18 250 VAC",
    "CAPACITOR DE CLIMA 40 MF 250VCA-450 VAC", "CAPACITOR DE CLIMA 45 MF 370-440-VAC-VCA",
    "CAPACITOR DE LAVADORA 60-20MFD-4TERMINALES", "CAPACITOR DE VENTILADOR 2MFD + 6MFD A 250VAC",
    "CAPACITOR DE W 4 MF+5MF A 250 V 50/60", "CAPACITOR DE W 21 6UF+5P 20 8UF A 250V AC",
    "CAPACITOR DUAL 50-5 MFD 370V", "CAPACITOR MFD 5+5+5 VOL 440", "CAPACITOR PARA ARRANQUE DE 53-64UF A 180VAC",
    "CAPACITOR PARA BOMBA 108-130 110V", "CAPACITOR PARA BOMBA 124-149 110V", "CAPACITOR PARA BOMBA 161-193 110V CHICO",
    "CAPACITOR PARA BOMBA 216-259", "CAPACITOR PARA BOMBA 21-25 250", "CAPACITOR PARA BOMBA 270-324",
    "CAPACITOR PARA BOMBA 400-480 UF 110-125VCA", "CAPACITOR PARA BOMBA 500-600 UF 110-125VAC",
    "CAPACITOR PARA BOMBA 590-708 UF 110-125VAC", "CAPACITOR PARA BOMBA 700-800 UF 110-125VAC",
    "CAPACITOR PARA BOMBA 88-108 110V", "CAPACITOR PARA BOMBA DE AGUA 270-32 MDF 110 VCA",
    "CAPACITOR PARA CLIMA 30 + 5 370VAC", "CAPACITOR PARA CLIMA 30-4 MF 440VOLT", "CAPACITOR PARA CLIMA DE 30UF 370V",
    "CAPACITOR PARA CLIMA DE 5 OUF 450V B", "CAPACITOR PARA HIDROLAVADORA 30 UF A 400VAC",
    "CAPACITOR PARA LAVADORA 35+18 250 VAC", "CAPACITOR PARA LAVADORA 45+14 A 250V", "CAPACITOR PARA LAVADORA 60-20 MFD",
    "CAPACITOR PARA LAVADORA 70 MDF 250 VCA", "CAPACITOR PARA LAVADORA SAMSUM 3.5 MDF", "CAPACITOR PARA MICROONDAS 0.91",
    "CAPACITOR PARA MOTOR 7.5 440", "CAPACITOR PARA REFRIGERADOR UMP 250 VAC", "CAPACITOR PARA RELEVADOR UMP 250 VAC",
    "CAPACITOR PARA VENTILADOR 1.5 MFD A 450V", "CAPACITOR PARA VENTILADOR 2MFD 250V", "CAPACITOR PARA VENTILADOR 6 MF 250V",
    "CAPACITOR PARA CLIMA 8 MFD A 370 VCA", "CAPACITOR PARA CLIMA 8 MFD 370 VCA"
]

# Lista de nombres de archivos de imagen
LISTA_IMAGENES = [
    "CAPACITOR_10MF_440_VCA.webp", "CAPACITOR_10MFD_440V_CABLE_NEGRO_ELEVADOR.webp",
    "CAPACITOR_12_5_5_MFD_370_VCA_PARA_VENTY_CON_CABLE.webp", "CAPACITOR_12_5_6_MFD_370V.webp",
    "CAPACITOR_14_MDF_250V.webp", "CAPACITOR_15_2_5_MFD_370_VCA.webp", "CAPACITOR_15_MFD_250VAC_P_CLIMA.webp",
    "CAPACITOR_15_MDF_250V.webp", "CAPACITOR_2_5_UF_450V_VENTILADOR.webp", "CAPACITOR_20_MFD_370-440VCA_GRIS.webp",
    "CAPACITOR_25_MFD_370-440_VCA_BLANCO.webp", "CAPACITOR_25MFD_5MFD_250V_4_TERMINALES_BLANCO.webp",
    "CAPACITOR_3_5MF_450V_NEGRO.webp", "CAPACITOR_30_10-5_MF_440_VCA_BOMBA.webp",
    "CAPACITOR_30_10UF_110_125_VAC.webp", "CAPACITOR_35_1_5_MF_440_VCA.webp",
    "CAPACITOR_35_2_5_MF_440_VCA.webp", "CAPACITOR_35_5_MFD_370_440VCA.webp", "CAPACITOR_35_6_370VCA.webp",
    "CAPACITOR_350MFD_250V_A_440VOLT.webp", "CAPACITOR_378-440_110_125.webp",
    "CAPACITOR_3UF_250_VAC_DE_VENTILADOR.webp", "CAPACITOR_3UF_450V_P_VENTILADOR.webp",
    "CAPACITOR_4_2_5_MF_370_VCA.webp", "CAPACITOR_4_5_MFD_450VCA.webp", "CAPACITOR_40_5_2_5_440_VCA.webp",
    "CAPACITOR_40_5_440_VCA.webp", "CAPACITOR_40_MDF_250VAC.webp", "CAPACITOR_40MF_450V_4_TERMINALES_BLANCO.webp",
    "CAPACITOR_4_5_UF_250_VCA.webp", "CAPACITOR_45_MF_250VAC_PLASTICO_BLANCO.webp",
    "CAPACITOR_45_MF_A_250_VCA_PARA_LAVADORA_CON_BASE.webp", "CAPACITOR_45_MFD_5_370_A_440.webp",
    "CAPACITOR_5_5_UF_250_VCA.webp", "CAPACITOR_50_MF_250_VCA.webp", "CAPACITOR_50_MF_370_VCA_440V.webp",
    "CAPACITOR_50_MFD_250VAC.webp", "CAPACITOR_50MFD_250-450VAC.webp", "CAPACITOR_50UF_370VCA.webp",
    "CAPACITOR_55_MFD_370_VCA_440.webp", "CAPACITOR_60_UF_250_VAC_MABE_ORIG.webp",
    "CAPACITOR_70_UF_250_VCA.webp", "CAPACITOR_72-88_220VAC_50-60HZ.webp", "CAPACITOR_8_MF_370_VCA.webp",
    "CAPACITOR_8_MFD_440_VCA.webp", "CAPACITOR_CON_CABLE_DE_5_5_250_VCA.webp", "CAPACITOR_DE_1_5_MF_450V.webp",
    "CAPACITOR_DE_1_8_MF_450V.webp", "CAPACITOR_DE_10_MF_250_VCA.webp", "CAPACITOR_DE_10_MFD_370_VCA.webp",
    "CAPACITOR_DE_15_A_250VAC.webp", "CAPACITOR_DE_15_MF_RECTANGULAR.webp", "CAPACITOR_DE_150MF_250VAC.webp",
    "CAPACITOR_DE_16MFD_250V_4_TERMINALES_BLANCO.webp", "CAPACITOR_DE_2_1_440_VCA.webp",
    "CAPACITOR_DE_2_2_UF_P_4_V_440_VAC.webp", "CAPACITOR_DE_25_MFD_A_440VOLT.webp",
    "CAPACITOR_DE_30_5_440V.webp", "CAPACITOR_DE_35_MF_250V.webp", "CAPACITOR_DE_35_5_MF_A_440_VAC.webp",
    "CAPACITOR_DE_350-400_125_VAC.webp", "CAPACITOR_DE_4_MF_450V_PARA_VENTILADOR.webp",
    "CAPACITOR_DE_4_5_MF_450V.webp", "CAPACITOR_DE_45-6_MF_A_250_VAC.webp", "CAPACITOR_DE_4MFD_250V.webp",
    "CAPACITOR_DE_4MFD_440_50_60.webp", "CAPACITOR_DE_5_5_UF_370_VCA.webp",
    "CAPACITOR_DE_50_5UF_370_440_VAC_CLIMA.webp", "CAPACITOR_DE_50_5UF_A_440VAC.webp",
    "CAPACITOR_DE_5MF_440V_50_60.webp", "CAPACITOR_DE_6_5_MFD_450V.webp", "CAPACITOR_DE_60_UF_A_440VAC.webp",
    "CAPACITOR_DE_60_5_MF_370_VCA.webp", "CAPACITOR_DE_6MFD_440-50_60_TERMINAL.webp",
    "CAPACITOR_DE_7_5UF_370V.webp", "CAPACITOR_DE_70_5_440V.webp", "CAPACITOR_DE_7MFD_370-50-60.webp",
    "CAPACITOR_DE_8_MF_450V.webp", "CAPACITOR_DE_BOMBA_40-48.webp", "CAPACITOR_DE_CLIMA_40_MF_250VCA-450_VAC.webp",
    "CAPACITOR_DE_CLIMA_45_MF_370-440-VAC-VCA.webp", "CAPACITOR_DE_DOBLE_15_UF_A_250VAC.webp",
    "CAPACITOR_DE_LAVADORA_35_18_250_VAC.webp", "CAPACITOR_DE_LAVADORA_60-20MFD-4TERMINALES.webp",
    "CAPACITOR_DE_VENTILADOR_2MFD_6MFD_A_250VAC.webp", "CAPACITOR_DE_W_21_6UF_5P_20_8UF_A_250V_AC.webp",
    "CAPACITOR_DE_W_4_MF_5MF_A_250_V_50_60.webp", "CAPACITOR_DUAL_50_5_MFD_370V.webp",
    "CAPACITOR_MFD_5_5_5_VOL_440.webp", "CAPACITOR_PARA_ARRANQUE_DE_53-64UF_A_180VAC.webp",
    "CAPACITOR_PARA_BOMBA_108-130_110V.webp", "CAPACITOR_PARA_BOMBA_124-149_110V.webp",
    "CAPACITOR_PARA_BOMBA_161-193_110V_CHICO.webp", "CAPACITOR_PARA_BOMBA_21-25_250.webp",
    "CAPACITOR_PARA_BOMBA_216-259.webp", "CAPACITOR_PARA_BOMBA_270-324.webp",
    "CAPACITOR_PARA_BOMBA_400-480_UF_110-125VCA.webp", "CAPACITOR_PARA_BOMBA_500-600_UF_110-125VAC.webp",
    "CAPACITOR_PARA_BOMBA_590-708_UF_110-125VAC.webp", "CAPACITOR_PARA_BOMBA_700-800_UF_110-125VAC.webp",
    "CAPACITOR_PARA_BOMBA_88-108_110V.webp", "CAPACITOR_PARA_BOMBA_DE_AGUA_270-32_MDF_110_VCA.webp",
    "CAPACITOR_PARA_CLIMA_30_5_370VAC.webp", "CAPACITOR_PARA_CLIMA_30-4_MF_440VOLT.webp",
    "CAPACITOR_PARA_CLIMA_DE_30UF_370V.webp", "CAPACITOR_PARA_CLIMA_DE_5_OUF_450V_B.webp",
    "CAPACITOR_PARA_HIDROLAVADORA_30_UF_A_400VAC.webp", "CAPACITOR_PARA_LAVADORA_45_14_A_250V.webp",
    "CAPACITOR_PARA_LAVADORA_60-20_MFD.webp", "CAPACITOR_PARA_LAVADORA_70_MDF_250_VCA.webp",
    "CAPACITOR_PARA_LAVADORA_SAMSUM_3_5_MDF.webp", "CAPACITOR_PARA_MICROONDAS_0_91.webp",
    "CAPACITOR_PARA_MOTOR_7_5_440.webp", "CAPACITOR_PARA_REFRIGERADOR_UMP_250_VAC.webp",
    "CAPACITOR_PARA_RELEVADOR_UMP_250_VAC.webp", "CAPACITOR_PARA_VENTILADOR_1_5_MFD_A_450V.webp",
    "CAPACITOR_PARA_VENTILADOR_2MFD_250V.webp", "CAPACITOR_PARA_VENTILADOR_6_MF_250V.webp",
    "CAPACITOR_PARA_CLIMA_8_MFD_A_370_VCA.webp"
]

# --- LÓGICA PRINCIPAL ---

def unir_listas():
    """
    Compara las dos listas y genera un archivo de Excel con los resultados.
    """
    # 1. Crear un mapa de búsqueda a partir de la lista de imágenes
    print(f"🖼️  Creando mapa de búsqueda con {len(LISTA_IMAGENES)} imágenes...")
    mapa_imagenes = {}
    for nombre_archivo in LISTA_IMAGENES:
        nombre_base = "".join(nombre_archivo.rsplit(".webp", 1))
        huella_digital = super_normalizar(nombre_base)
        mapa_imagenes[huella_digital] = nombre_archivo
    
    # 2. Recorrer la lista de descripciones y buscar coincidencias
    print(f"🔄 Comparando {len(LISTA_DESCRIPCIONES)} descripciones con el mapa de imágenes...")
    resultados = []
    coincidencias = 0
    for descripcion in LISTA_DESCRIPCIONES:
        huella_descripcion = super_normalizar(descripcion)
        
        # Buscar la huella en el mapa. Usar .get() para evitar errores si no se encuentra.
        imagen_encontrada = mapa_imagenes.get(huella_descripcion, "NO ENCONTRADO")
        
        if imagen_encontrada != "NO ENCONTRADO":
            coincidencias += 1
            
        resultados.append({
            "Descripcion Original": descripcion,
            "Imagen Correspondiente": imagen_encontrada
        })
        
    # 3. Crear un DataFrame y guardarlo en Excel
    print("\n✍️  Creando el archivo de Excel...")
    df_resultados = pd.DataFrame(resultados)
    
    try:
        df_resultados.to_excel(NOMBRE_ARCHIVO_SALIDA, index=False)
        print("\n" + "="*40)
        print("✨ ¡Proceso completado con éxito! ✨")
        print(f"✔️ Se encontraron {coincidencias} de {len(LISTA_DESCRIPCIONES)} posibles coincidencias.")
        print(f"💾 El archivo '{NOMBRE_ARCHIVO_SALIDA}' ha sido creado.")
        print("="*40)
    except Exception as e:
        print(f"🚨 Ocurrió un error al guardar el archivo de Excel: {e}")

# --- Iniciar el script ---
if __name__ == "__main__":
    unir_listas()